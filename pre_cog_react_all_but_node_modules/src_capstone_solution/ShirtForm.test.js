import { act, render } from '@testing-library/react';
import userEvent from '@testing-library/user-event';
import ShirtForm from './ShirtForm';

const consoles = [];

// Workaround for console errors regarding 'submit' despite passing tests
// https://github.com/jsdom/jsdom/issues/1937#issuecomment-526162324
describe('submission', () => {
  beforeEach(() => {
    window._virtualConsole.emit = jest.fn();
  });

  test('shirt size is added on form submission', async () => {
    let updatedShirts = [];
    const mockSubmission = jest.fn(event => {
      updatedShirts = [
        ...consoles,
        Object.fromEntries(new FormData(event.target)),
      ];
    });

    await act(async () => {
      render(<ShirtForm handler={mockSubmission} />);

      userEvent.type(document.getElementById('size'), '5XL');
      userEvent.click(document.querySelector('button[type="submit"]'));
    });

    expect(updatedShirts[0].size).toBe('5XL');
  });
});
