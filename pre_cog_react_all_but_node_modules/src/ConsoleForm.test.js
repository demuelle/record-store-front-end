import { act, render } from '@testing-library/react';
import userEvent from '@testing-library/user-event';
import ConsoleForm from './ConsoleForm';

const consoles = [];

// Workaround for console errors regarding 'submit' despite passing tests
// https://github.com/jsdom/jsdom/issues/1937#issuecomment-526162324
describe('submission', () => {
  beforeEach(() => {
    window._virtualConsole.emit = jest.fn();
  });

  test('console model title is added on form submission', async () => {
    let updatedConsoles = [];
    const mockSubmission = jest.fn(event => {
      updatedConsoles = [
        ...consoles,
        Object.fromEntries(new FormData(event.target)),
      ];
    });

    await act(async () => {
      render(<ConsoleForm handler={mockSubmission} />);

      userEvent.type(document.getElementById('model'), 'PS2');
      userEvent.click(document.querySelector('button[type="submit"]'));
    });

    expect(updatedConsoles[0].model).toBe('PS2');
  });
});
