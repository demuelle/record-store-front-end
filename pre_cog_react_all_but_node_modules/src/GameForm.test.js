import { act, render } from '@testing-library/react';
import userEvent from '@testing-library/user-event';
import GameForm from './GameForm';

const games = [];

// Workaround for console errors regarding 'submit' despite passing tests
// https://github.com/jsdom/jsdom/issues/1937#issuecomment-526162324
describe('submission', () => {
  beforeEach(() => {
    window._virtualConsole.emit = jest.fn();
  });

  test('game title is added on form submission', async () => {
    let updatedGames = [];
    const mockSubmission = jest.fn(event => {
      updatedGames = [...games, Object.fromEntries(new FormData(event.target))];
    });

    await act(async () => {
      render(<GameForm handler={mockSubmission} />);

      userEvent.type(document.getElementById('title'), 'Super Mario Bros 3');
      userEvent.click(document.querySelector('button[type="submit"]'));
    });

    expect(updatedGames[0].title).toBe('Super Mario Bros 3');
  });
});
