import { render } from '@testing-library/react';
import EncounterCard from './EncounterCard';

const encounter = {
  id: 1,
  brief: 'Tingling sensation',
  details: 'I swear something is near me. I just know it.',
  dateTime: '19-Feb-2021 11:35AM',
  imageUrl: 'http://example.com/path/to/an/image.png',
  investigators: [
    { id: 1, firstName: 'Koo', lastName: 'Artaern' },
    { id: 3, firstName: 'Monto', lastName: 'Caarew' },
  ],
};

test('renders "Tingling sensation"', () => {
  render(<EncounterCard encounter={encounter} />);

  const header = document.querySelector('.card-header');
  expect(header.innerHTML.trim()).toBe('Tingling sensation');
});

describe('ROLE_ADMIN', () => {
  test('has delete button', () => {
    const result = render(
      <EncounterCard encounter={encounter} role="ROLE_ADMIN" />
    );
    const button = result.getByText('Delete');
    expect(button).toBeInTheDocument();
    expect(button).toBeInstanceOf(HTMLButtonElement);
  });

  test('has edit button', () => {
    const result = render(
      <EncounterCard encounter={encounter} role="ROLE_ADMIN" />
    );
    const button = result.getByText('Edit');
    expect(button).toBeInTheDocument();
    expect(button).toBeInstanceOf(HTMLButtonElement);
  });
});

describe('ROLE_USER', () => {
  test('does not have delete button', () => {
    render(<EncounterCard encounter={encounter} role="ROLE_USER" />);
    const button = document.querySelector('.btn-danger');
    expect(button).not.toBeInTheDocument();
  });

  test('has edit button', () => {
    const result = render(
      <EncounterCard encounter={encounter} role="ROLE_USER" />
    );
    const button = result.getByText('Edit');
    expect(button).toBeInTheDocument();
    expect(button).toBeInstanceOf(HTMLButtonElement);
  });
});
